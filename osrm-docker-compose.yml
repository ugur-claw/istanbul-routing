# OSRM Docker Compose Configuration
# This file sets up OSRM with multiple profiles (car, foot, bike)
# Each profile requires pre-processed data

version: '3.8'

services:
  # OSRM - Car (Driving)
  osrm-car:
    image: osrm/osrm-backend
    container_name: istanbul-osrm-car
    ports:
      - "5000:5000"
    volumes:
      - ./osrm-data-car:/data
    environment:
      - THREADS=8
    command: >
      osrm-routed
      --algorithm ch
      --max-table-size 10000
      /data/istanbul
    restart: unless-stopped
    networks:
      - osrm-network

  # OSRM - Walking (Foot)
  osrm-walk:
    image: osrm/osrm-backend
    container_name: istanbul-osrm-walk
    ports:
      - "5001:5000"
    volumes:
      - ./osrm-data-walk:/data
    environment:
      - THREADS=8
    command: >
      osrm-routed
      --algorithm ch
      --max-table-size 10000
      --profile /opt/profiles/foot.lua
      /data/istanbul
    restart: unless-stopped
    networks:
      - osrm-network

  # OSRM - Bicycle
  osrm-bike:
    image: osrm/osrm-backend
    container_name: istanbul-osrm-bike
    ports:
      - "5002:5000"
    volumes:
      - ./osrm-data-bike:/data
    environment:
      - THREADS=8
    command: >
      osrm-routed
      --algorithm ch
      --max-table-size 10000
      --profile /opt/profiles/bicycle.lua
      /data/istanbul
    restart: unless-stopped
    networks:
      - osrm-network

networks:
  osrm-network:
    driver: bridge
